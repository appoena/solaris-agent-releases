<?xml version="1.0"?>
<!DOCTYPE service_bundle SYSTEM "/usr/share/lib/xml/dtd/service_bundle.dtd.1">
<!--
    SMF Manifest for a Appoena Solaris Datadog Agent
-->
<service_bundle type='manifest' name='appoena/solaris_agent'>
    <service
            name='appoena/solaris_agent'
            type='service'
            version='1'>

        <dependency name='network'
                    grouping='require_all'
                    restart_on='error'
                    type='service'>
            <!--
                This dependency ensures that the network is available before
                attempting to start this service. 'svc:/milestone/network:default'
            -->
            <service_fmri value='svc:/milestone/network:default'/>
        </dependency>

        <dependency name='multi-user-server'
                    grouping='require_all'
                    restart_on='error'
                    type='service'>
            <!--
                This dependency ensures that the system has reached the
                multi-user server milestone (equivalent to SysV init runlevel 3).
            -->
            <service_fmri value='svc:/milestone/multi-user-server:default'/>
        </dependency>

        <method_context>
            <method_environment>
                <envvar name='PATH' value='/usr/sbin:/usr/bin:/usr/local/bin:/etc/appoena/solaris/agent.jar'/>
            </method_environment>
        </method_context>

        <exec_method
                type='method'
                name='start'
                exec='java -jar /etc/appoena/solaris/agent.jar'
                timeout_seconds='300'>
            <!--
                '&' symbol indicates that the service is a daemon.
            -->
        </exec_method>

        <exec_method
                type='method'
                name='stop'
                exec=':kill'
                timeout_seconds='300'>
        </exec_method>

        <exec_method
                type='method'
                name='refresh'
                exec=':true'
                timeout_seconds='60'>
            <!--
                'svcadm refresh :true' is a no-op
            -->
        </exec_method>

        <property_group name='startd' type='framework'>
            <propval name='duration' type='astring' value='contract'/>
            <propval name='restart_on' type='astring' value='error'/>
            <propval name='ignore_error' type='astring' value='false'/>
        </property_group>
        <property_group name='application' type='application'>
            <propval name='start_timeout' type='count' value='300'/>
            <propval name='stop_timeout' type='count' value='300'/>
        </property_group>
        <instance name='default' enabled='false'/>

        <template>
            <common_name>
                <loctext xml:lang='en'>
                    Appoena Solaris Datadog Agent
                </loctext>
            </common_name>
            <description>
                <loctext xml:lang='en'>
                    This service executes the Appoena Solaris Datadog Agent
                </loctext>
            </description>
        </template>
    </service>
</service_bundle>